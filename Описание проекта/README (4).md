# Скрипты для оптимизации кодовой базы

В этой директории находятся скрипты для анализа и оптимизации кодовой базы проекта "Бар-да-бар".

## Скрипт проверки дублирования кода (`check-duplicates.js`)

Скрипт для поиска и устранения дублирования кода в проекте.

### Возможности

- Поиск идентичных файлов по содержимому
- Поиск похожих файлов с высоким процентом совпадения
- Анализ импортов для выявления проблемных зависимостей
- Автоматическое исправление найденных проблем (опционально)

### Использование

```bash
node scripts/check-duplicates.js [опции]
```

### Опции

- `--fix` - Автоматически исправлять найденные проблемы (если возможно)
- `--verbose` - Подробный вывод информации
- `--path` - Путь для проверки (по умолчанию: текущая директория)

### Примеры

```bash
# Проверка всего проекта без внесения изменений
node scripts/check-duplicates.js

# Проверка с подробным выводом
node scripts/check-duplicates.js --verbose

# Проверка и автоматическое исправление проблем
node scripts/check-duplicates.js --fix

# Проверка конкретной директории
node scripts/check-duplicates.js --path ./backend/src
```

## Скрипт унификации подключения к базе данных (`unify-database-connection.js`)

Скрипт для унификации импортов подключения к базе данных в проекте.

### Возможности

- Замена импортов из `../config/database` на `../db/connection` (или наоборот)
- Создание резервной копии файлов перед изменением
- Тестовый режим без внесения изменений
- Подробный отчет о выполненных изменениях

### Использование

```bash
node scripts/unify-database-connection.js [опции]
```

### Опции

- `--target=connection` - Использовать `../db/connection` как целевой импорт (по умолчанию)
- `--target=database` - Использовать `../config/database` как целевой импорт
- `--dry-run` - Не вносить изменения, только показать, что будет изменено
- `--verbose` - Подробный вывод информации

### Примеры

```bash
# Тестовый запуск без внесения изменений
node scripts/unify-database-connection.js --dry-run

# Унификация импортов на ../db/connection
node scripts/unify-database-connection.js

# Унификация импортов на ../config/database
node scripts/unify-database-connection.js --target=database

# Подробный вывод информации
node scripts/unify-database-connection.js --verbose
```

## Рекомендации по использованию

1. Перед внесением изменений всегда запускайте скрипты в тестовом режиме (`--dry-run` или без `--fix`)
2. Создавайте резервную копию проекта перед запуском скриптов с автоматическим исправлением
3. После внесения изменений проверяйте работоспособность проекта
4. Обновляйте документацию проекта после успешного применения изменений

## Выполненные оптимизации

### Унификация подключения к базе данных (выполнено)

В рамках оптимизации кодовой базы были выполнены следующие изменения:

1. Удален неиспользуемый файл `backend/src/config/database.js`
2. Обновлен файл `backend/src/db/connection.ts` для использования `../config/env.js` вместо прямого доступа к `process.env`
3. Улучшена функция `getClient()` в `connection.ts` для более детального логирования запросов
4. Добавлены улучшенные сообщения при graceful shutdown

Все импорты в проекте теперь используют единый файл подключения к базе данных `backend/src/db/connection.ts`.

## Тестовые скрипты

### Скрипт проверки подключения к базе данных (`test-db-connection.js`)

Скрипт для тестирования подключения к базе данных после унификации файлов подключения.

### Возможности

- Проверка успешного подключения к базе данных
- Выполнение тестового SQL-запроса
- Подробный вывод результатов тестирования

### Использование

```bash
node scripts/test-db-connection.js
```

### Примеры

```bash
# Запуск тестирования подключения к базе данных
node scripts/test-db-connection.js
```

## Дополнительная информация

Дополнительные рекомендации по оптимизации кодовой базы можно найти в файле `РЕКОМЕНДАЦИИ.md` в корне проекта.