# Тестирование отправки уведомлений в Telegram

Этот документ содержит инструкции по тестированию функциональности отправки уведомлений в Telegram для проекта "Бар-да-бар".

## Предварительные требования

1. Node.js и npm установлены
2. Настроены переменные окружения в файле `.env`:
   - `TELEGRAM_BOT_TOKEN` - токен вашего Telegram бота
   - `TELEGRAM_CHAT_ID` - ID чата для отправки уведомлений

## Создание Telegram бота и получение токена

1. Откройте Telegram и найдите бота @BotFather
2. Отправьте команду `/newbot`
3. Следуйте инструкциям BotFather:
   - Введите имя бота (например, "Бар-да-бар Уведомления")
   - Введите username бота (должен заканчиваться на "bot", например, "bardabar_notifications_bot")
4. После успешного создания бота, BotFather отправит вам сообщение с токеном бота
5. Скопируйте этот токен и вставьте его в файл `.env` в качестве значения для `TELEGRAM_BOT_TOKEN`

## Получение TELEGRAM_CHAT_ID

### Вариант 1: Для личных сообщений

1. Найдите в Telegram бота @userinfobot
2. Отправьте ему любое сообщение
3. Бот ответит вам сообщением, содержащим ваш ID
4. Скопируйте этот ID и вставьте его в файл `.env` в качестве значения для `TELEGRAM_CHAT_ID`

### Вариант 2: Для группового чата

1. Добавьте вашего бота в групповой чат
2. Отправьте в этот чат любое сообщение
3. Откройте в браузере URL: `https://api.telegram.org/bot<TELEGRAM_BOT_TOKEN>/getUpdates`
   (замените `<TELEGRAM_BOT_TOKEN>` на ваш токен)
4. В ответе найдите поле `chat` и внутри него поле `id` - это и есть ID чата
5. Скопируйте этот ID и вставьте его в файл `.env` в качестве значения для `TELEGRAM_CHAT_ID`

## Запуск тестового сервера

1. Перейдите в директорию `backend`
2. Выполните команду:

```bash
node test-telegram.js
```

3. Откройте в браузере адрес: http://localhost:3001

## Использование тестовой страницы

1. На открывшейся странице вы увидите форму для отправки тестового уведомления
2. Введите текст сообщения в поле ввода
3. Нажмите кнопку "Отправить уведомление"
4. Результат отправки будет отображен на странице
5. Проверьте получение сообщения в указанном Telegram чате

## Возможные проблемы и их решение

### Ошибка: "Не настроены переменные окружения для Telegram"

**Решение:** Убедитесь, что в файле `.env` правильно указаны значения для `TELEGRAM_BOT_TOKEN` и `TELEGRAM_CHAT_ID`.

### Ошибка: "Request failed with status code 404" или "Not Found"

**Решение:** Эта ошибка обычно означает, что токен бота невалиден или бот был удален. Создайте нового бота через @BotFather и обновите токен в файле `.env`.

### Ошибка: "Forbidden: bot was blocked by the user"

**Решение:** Убедитесь, что бот не заблокирован в чате и имеет права на отправку сообщений.

### Ошибка: "Chat not found"

**Решение:** Проверьте правильность указанного `TELEGRAM_CHAT_ID`. Возможно, бот не добавлен в указанный чат.

## Интеграция в основное приложение

Функциональность отправки уведомлений в Telegram уже интегрирована в основное приложение через маршрут `/api/telegram/send`. Этот маршрут используется в контроллерах для отправки уведомлений о новых бронированиях и контактных формах.

## Дополнительная информация

Для отправки уведомлений в Telegram используется утилита `sendTelegramNotification` из файла `src/utils/telegramNotifier.js`. Эта утилита может быть использована в любом месте приложения для отправки произвольных уведомлений.